<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Guide · dREL Tools documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">dREL Tools documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Guide</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Translating-dREL"><span>Translating dREL</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jamesrhester/dRELTools.jl/blob/master/docs/src/guide.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Guide-to-using-CIF_dREL"><a class="docs-heading-anchor" href="#Guide-to-using-CIF_dREL">Guide to using CIF_dREL</a><a id="Guide-to-using-CIF_dREL-1"></a><a class="docs-heading-anchor-permalink" href="#Guide-to-using-CIF_dREL" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p><code>CIF_dREL</code> provides methods and types that take advantage of code embedded in CIF dictionaries (ontologies) that describes mathematical relationships between data names defined in those ontologies. To do this, it translates those methods into Julia code that can be executed, for example, to find or check missing values.</p><p>Before reading the following, you should be familiar with  the <code>CrystalInfoFramework.jl</code> documentation for working with CIF files and dictionaries.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><h3 id="Preparation"><a class="docs-heading-anchor" href="#Preparation">Preparation</a><a id="Preparation-1"></a><a class="docs-heading-anchor-permalink" href="#Preparation" title="Permalink"></a></h3><p>Read in the CIF dictionary, and prepare any dREL <em>functions</em> defined in the dictionary:</p><pre><code class="language-julia">dict = DDLm_Dictionary(&quot;cif_core.dic&quot;)
define_dict_funcs!(dict)    #add dREL Functions to dictionary</code></pre><p>In DDLm, dREL functions are defined in categories that have <code>_definition.class</code> of <code>Function</code>. They should not be confused with dREL <em>methods</em>, which are associated with particular data names or categories.</p><p>The <code>DDLm_Dictionary</code> type used above is defined in <code>CrystalInfoFramework.jl</code>. <code>DDL2_Dictionary</code>s may also be used, but only methods of type <code>dREL</code> will be recognised.</p><p><a href="../api/#dRELTools.define_dict_funcs!-Tuple{Any}"><code>define_dict_funcs!</code></a> will process all dREL functions found in the dictionary and make them available to dREL methods. They can be inspected via the  <code>CrystalInfoFramework</code> <code>get_dict_func</code> method.</p><p>dREL methods operate on any source of data that returns the correct data types and has a relational structure.  We use a  <code>CrystalInfoFramework</code> <code>TypedDataSource</code> created from a CIF block:</p><pre><code class="language-julia">n = Cif(&quot;nick1.cif&quot;)
b = n[&quot;saly2_all_aniso&quot;] #select a data block
t = TypedDataSource(b,dict)</code></pre><p>The final step is to create a <a href="../api/#dRELTools.DynamicDDLmRC"><code>DynamicDDLmRC</code></a> type that allows new values to be derived given a dictionary describing the mathematical relationships:</p><pre><code class="language-julia">dd = DynamicDDLmRC(t,dict)</code></pre><p>Note that in this case the dictionary used for typing, and the dictionary used for dREL methods and to create the relational structure, are the same dictionary.</p><h3 id="Derivation"><a class="docs-heading-anchor" href="#Derivation">Derivation</a><a id="Derivation-1"></a><a class="docs-heading-anchor-permalink" href="#Derivation" title="Permalink"></a></h3><p>A request for a data name whose value is not found in the <code>DynamicDDLmRC</code> object will trigger derivation:</p><pre><code class="language-julia">dd[&quot;_cell.volume&quot;]</code></pre><p>A whole category may also be computed if the values needed for the calculation are present:</p><pre><code class="language-julia">dd[&quot;geom_bond&quot;]</code></pre><p>Note that, as computations (currently) can take significant time, results are cached. To clear this cache, call <a href="../api/#dRELTools.empty_cache!-Tuple{DynamicDDLmRC}"><code>empty_cache!</code></a>.</p><p><code>test/drel_exec.jl</code> contains demonstrations of how to make use of dREL scripts found in dictionaries.</p><h3 id="Namespaces"><a class="docs-heading-anchor" href="#Namespaces">Namespaces</a><a id="Namespaces-1"></a><a class="docs-heading-anchor-permalink" href="#Namespaces" title="Permalink"></a></h3><p>Advanced users may have <code>DataSource</code>s with data names from different namespaces. Provide a further <code>nspace</code> argument to disambiguate in this case:</p><pre><code class="language-julia">dd[&quot;_cell.volume&quot;,&quot;CifCore&quot;]</code></pre><h2 id="Translating-dREL"><a class="docs-heading-anchor" href="#Translating-dREL">Translating dREL</a><a id="Translating-dREL-1"></a><a class="docs-heading-anchor-permalink" href="#Translating-dREL" title="Permalink"></a></h2><p>If you wish simply to transform some dREL code into Julia, you can use <a href="../api/#dRELTools.make_julia_code-Tuple{Any,Any,Any}"><code>make_julia_code</code></a>.  You will need to provide the dREL fragment, the data name it is associated with (or category name), and the CIF dictionary. The returned <code>Expr</code> will need to be evaluated and assigned to a variable before it can be executed. The arguments to the returned function are the datablock and a single row of the category to which the defined value belongs.</p><pre><code class="language-julia">dreltext = &quot;&quot;&quot;
      With c  as  cell
 
      _cell.volume =  c.vector_a * ( c.vector_b ^ c.vector_c )

&quot;&quot;&quot;
make_julia_code(dreltext,&quot;_cell.volume&quot;,dict)

# output

function (__datablock::DynamicRelationalContainer, __packet::CatPacket)
    #= /home/jrh/programs/CIF/dRELTools.jl/src/drel_ast.jl:397 =#
    __dict = missing
    c = missing
    __dreltarget = missing
    #= /home/jrh/programs/CIF/dRELTools.jl/src/jl_transformer.jl:120 =#
    #= /home/jrh/programs/CIF/dRELTools.jl/src/jl_transformer.jl:122 =#
    begin
        __dict = get_dictionary(__datablock, &quot;CifCore&quot;)
        begin
            c = __packet
            #= /home/jrh/programs/CIF/dRELTools.jl/src/jl_transformer.jl:651 =#
            begin
                __dreltarget = drel_property_access(c, &quot;vector_a&quot;, __datablock)::drelvector * cross(drel_property_access(c, &quot;vector_b&quot;, __datablock)::drelvector, drel_property_access(c, &quot;vector_c&quot;, __datablock)::drelvector)
            end
        end
        return __dreltarget
    end
end
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 18 December 2020 23:11">Friday 18 December 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
